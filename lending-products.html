<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lending Products - FoxPro</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            color: #333;
            font-size: 32px;
            margin-bottom: 10px;
        }
        
        .header p {
            color: #666;
            font-size: 16px;
        }
        
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 24px;
            margin-bottom: 30px;
        }
        
        .product-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
            border-color: #667eea;
        }
        
        .product-name {
            font-size: 22px;
            font-weight: 700;
            color: #333;
            margin-bottom: 8px;
        }
        
        .product-desc {
            color: #666;
            font-size: 14px;
            margin-bottom: 16px;
            min-height: 40px;
        }
        
        .product-details {
            background: #f5f7fa;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
        }
        
        .detail-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .detail-row:last-child {
            border-bottom: none;
        }
        
        .detail-label {
            color: #666;
            font-weight: 600;
            font-size: 13px;
        }
        
        .detail-value {
            color: #333;
            font-weight: 700;
            font-size: 16px;
        }
        
        .detail-value.highlight {
            color: #667eea;
        }
        
        .amount-range {
            background: #e8eef7;
            color: #333;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            margin-bottom: 16px;
        }
        
        .apply-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .apply-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }
        
        .apply-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .status-badge {
            display: inline-block;
            padding: 6px 12px;
            background: #d1fae5;
            color: #065f46;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 12px;
        }
        
        .status-badge.disabled {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .empty-state {
            background: white;
            border-radius: 12px;
            padding: 60px 20px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 16px;
        }
        
        .empty-state-title {
            font-size: 24px;
            color: #333;
            margin-bottom: 8px;
            font-weight: 700;
        }
        
        .empty-state-text {
            color: #666;
            font-size: 16px;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.show {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 32px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        .modal-header {
            font-size: 24px;
            font-weight: 700;
            color: #333;
            margin-bottom: 24px;
        }
        
        .form-group {
            margin-bottom: 16px;
        }
        
        .form-group label {
            display: block;
            color: #555;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .form-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .button-group {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }
        
        .btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 16px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }
        
        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }
        
        .btn-secondary:hover {
            background: #e0e0e0;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: white;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .info-banner {
            background: rgba(255, 255, 255, 0.95);
            border-left: 4px solid #667eea;
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 24px;
        }
        
        .info-banner-title {
            font-weight: 700;
            color: #333;
            margin-bottom: 8px;
        }
        
        .info-banner-text {
            color: #666;
            font-size: 14px;
        }
        
        .nav-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: white;
            padding: 16px 32px;
            border-radius: 12px;
            margin-bottom: 24px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .nav-logo {
            font-size: 20px;
            font-weight: 700;
            color: #667eea;
        }
        
        .nav-links {
            display: flex;
            gap: 24px;
        }
        
        .nav-link {
            color: #666;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .nav-link:hover {
            color: #667eea;
        }
        
        .nav-link.active {
            color: #667eea;
            border-bottom: 2px solid #667eea;
            padding-bottom: 4px;
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <div class="nav-header">
        <div class="nav-logo">üí∞ FoxPro Lending</div>
        <div class="nav-links">
            <a href="index.html" class="nav-link">Home</a>
            <a href="market.html" class="nav-link">Trading</a>
            <a href="lending-products.html" class="nav-link active">Lending</a>
            <a href="account.html" class="nav-link">Account</a>
        </div>
    </div>
    
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üè¶ Lending Products</h1>
            <p>Choose the right lending product for you and get quick financial support</p>
        </div>
        
        <!-- Information Banner -->
        <div class="info-banner">
            <div class="info-banner-title">‚ú® Quick Lending</div>
            <div class="info-banner-text">
                We offer a variety of lending products, from small emergency loans to large business loans, meeting your different needs.
                Click "Apply Now" to select the lending product you want, fill out the application form, and we will review your application within 24 hours.
            </div>
        </div>
        
        <!-- Products Grid -->
        <div id="productsContainer" class="products-grid">
            <div class="loading">
                <div class="loading-spinner"></div>
                <p style="margin-top: 16px;">Loading...</p>
            </div>
        </div>
    </div>
    
    <!-- Application Modal -->
    <div id="applyModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">üìã Apply for Loan</div>
            
            <form onsubmit="submitApplication(event)">
                <div class="form-group">
                    <label>Select Product</label>
                    <input type="text" id="selectedProduct" disabled style="background: #f5f5f5;">
                </div>
                
                <div class="form-group">
                    <label>Loan Amount</label>
                    <input type="number" id="loanAmount" placeholder="Please enter loan amount" min="0" step="0.01" required>
                </div>
                
                <div class="form-group">
                    <label>Loan Term</label>
                    <input type="number" id="loanTerm" placeholder="Please enter loan term" disabled style="background: #f5f5f5;">
                </div>
                
                <div class="form-group">
                    <label>Interest Rate</label>
                    <input type="number" id="loanRate" placeholder="Interest Rate" disabled style="background: #f5f5f5;">
                </div>
                
                <div class="form-group">
                    <label>Expected Profit</label>
                    <input type="text" id="expectedProfit" disabled style="background: #f5f5f5;">
                </div>
                
                <div class="button-group">
                    <button type="submit" class="btn btn-primary">‚úì Confirm Application</button>
                    <button type="button" class="btn btn-secondary" onclick="closeApplyModal()">‚úï Cancel</button>
                </div>
            </form>
        </div>
    </div>
    
    <script>
        const API_BASE = 'http://localhost:3000/api';
        let selectedProductData = null;
        
        // Page loading
        document.addEventListener('DOMContentLoaded', () => {
            loadLendingProducts();
        });
        
        // Load lending products
        async function loadLendingProducts() {
            try {
                const response = await fetch(`${API_BASE}/lending/products`);
                const data = await response.json();
                
                if (data.success && Array.isArray(data.data)) {
                    displayProducts(data.data);
                } else {
                    showEmptyState();
                }
            } catch (error) {
                console.error('Failed to load products:', error);
                showEmptyState('Failed to load, please try again later');
            }
        }
        
        // Display products
        function displayProducts(products) {
            if (products.length === 0) {
                showEmptyState();
                return;
            }
            
            const container = document.getElementById('productsContainer');
            container.innerHTML = products.map(product => `
                <div class="product-card">
                    <div class="status-badge ${!product.enabled ? 'disabled' : ''}">
                        ${product.enabled ? '‚úì Available' : '‚úó Discontinued'}
                    </div>
                    
                    <div class="product-name">${product.name}</div>
                    <div class="product-desc">${product.description || 'ÁÅµÊ¥ªÁöÑÂÄüË¥∑‰∫ßÂìÅ'}</div>
                    
                    <div class="amount-range">
                        üí∞ Loan Amount: ¬•${product.minAmount.toFixed(2)} - ¬•${product.maxAmount.toFixed(2)}
                    </div>
                    
                    <div class="product-details">
                        <div class="detail-row">
                            <span class="detail-label">Annual Interest Rate</span>
                            <span class="detail-value highlight">${product.rate}%</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Loan Term</span>
                            <span class="detail-value">${product.term} Days</span>
                        </div>
                    </div>
                    
                    <button class="apply-btn" 
                            ${!product.enabled ? 'disabled' : ''}
                            onclick="openApplyModal('${product.id}', '${product.name}', ${product.minAmount}, ${product.maxAmount}, ${product.rate}, ${product.term})">
                        ${product.enabled ? 'üí≥ Apply Now' : 'Not Available'}
                    </button>
                </div>
            `).join('');
        }
        
        // Display empty state
        function showEmptyState(message = 'No lending products available') {
            document.getElementById('productsContainer').innerHTML = `
                <div style="grid-column: 1/-1;">
                    <div class="empty-state">
                        <div class="empty-state-icon">üîî</div>
                        <div class="empty-state-title">${message}</div>
                        <div class="empty-state-text">Please come back later to check our lending products</div>
                    </div>
                </div>
            `;
        }
        
        // Open application modal
        function openApplyModal(productId, productName, minAmount, maxAmount, rate, term) {
            selectedProductData = { productId, productName, minAmount, maxAmount, rate, term };
            
            document.getElementById('selectedProduct').value = productName;
            document.getElementById('loanAmount').value = '';
            document.getElementById('loanAmount').min = minAmount;
            document.getElementById('loanAmount').max = maxAmount;
            document.getElementById('loanTerm').value = term;
            document.getElementById('loanRate').value = rate + '%';
            
            document.getElementById('loanAmount').addEventListener('input', calculateProfit);
            document.getElementById('applyModal').classList.add('show');
        }
        
        // Close application modal
        function closeApplyModal() {
            document.getElementById('applyModal').classList.remove('show');
            selectedProductData = null;
        }
        
        // Calculate expected profit
        function calculateProfit() {
            const amount = parseFloat(document.getElementById('loanAmount').value) || 0;
            const rate = parseFloat(selectedProductData.rate) || 0;
            const term = parseFloat(selectedProductData.term) || 0;
            
            const profit = (amount * rate / 100 / 365 * term).toFixed(2);
            document.getElementById('expectedProfit').value = `¬•${profit}`;
        }
        
        // Submit application
        async function submitApplication(event) {
            event.preventDefault();
            
            const amount = parseFloat(document.getElementById('loanAmount').value);
            
            if (!selectedProductData) {
                alert('Please select a lending product');
                return;
            }
            
            if (amount < selectedProductData.minAmount || amount > selectedProductData.maxAmount) {
                alert(`Loan amount must be between ¬•${selectedProductData.minAmount} and ¬•${selectedProductData.maxAmount}`);
                return;
            }
            
            try {
                const token = localStorage.getItem('token');
                if (!token) {
                    alert('Please log in first');
                    window.location.href = 'login.html';
                    return;
                }
                
                const response = await fetch(`${API_BASE}/lending/apply`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        amount: amount,
                        rate: selectedProductData.rate,
                        term: selectedProductData.term
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('‚úì Loan application has been submitted. Please wait for review results');
                    closeApplyModal();
                } else {
                    alert('‚úó Application failed: ' + (data.message || data.error));
                }
            } catch (error) {
                console.error('Application error:', error);
                alert('Application failed, please try again later');
            }
        }

        // ============ Ëá™Âä®ÂÆûÊó∂Âà∑Êñ∞‰∫ßÂìÅÂàóË°® ============
        setInterval(() => {
          loadProducts();
        }, 5000); // ÊØè5ÁßíÂà∑Êñ∞‰∏ÄÊ¨°
        
        // Close modal when clicking outside
        document.getElementById('applyModal').addEventListener('click', (e) => {
            if (e.target.id === 'applyModal') {
                closeApplyModal();
            }
        });
    </script>
</body>
</html>
